<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Criar Conta</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; padding: 20px; background: #f4f7f6; }
        .card { background: white; padding: 30px; border-radius: 8px; width: 400px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input, select { width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .hidden { display: none; }
        a { display: block; text-align: center; margin-top: 15px; color: #007bff; text-decoration: none; }
    </style>
</head>
<body>
    <div class="card">
        <h2>üìù Cadastre-se</h2>
        
        <label>Eu sou:</label>
        <select id="tipo" onchange="mudarCampos()">
            <option value="PACIENTE">Paciente</option>
            <option value="MEDICO">M√©dico</option>
        </select>

        <label>Nome:</label> <input type="text" id="nome">
        <label>Email:</label> <input type="email" id="email">
        <label>Senha:</label> <input type="password" id="senha">
        <label>Telefone:</label> <input type="text" id="telefone">

        <div id="pacienteDocs">
            <label>CPF:</label> <input type="text" id="cpf">
            <label>Data Nasc:</label> <input type="date" id="data">
            <label>Endere√ßo:</label> <input type="text" id="endereco">
        </div>

        <div id="medicoDocs" class="hidden">
            <label>CRM:</label> <input type="text" id="crm">
            <label>Especialidade:</label> <input type="text" id="esp">
        </div>

        <button onclick="cadastrar()">Criar Conta</button>
        <a href="login.html">J√° tem conta? Fa√ßa Login</a>
    </div>

    <script>
        function mudarCampos() {
            const tipo = document.getElementById("tipo").value;
            document.getElementById("pacienteDocs").classList.toggle("hidden", tipo === "MEDICO");
            document.getElementById("medicoDocs").classList.toggle("hidden", tipo === "PACIENTE");
        }

        async function cadastrar() {
            const tipo = document.getElementById("tipo").value;
            let dados = {
                tipoUsuario: tipo,
                nome: document.getElementById("nome").value,
                email: document.getElementById("email").value,
                senha: document.getElementById("senha").value,
                telefone: document.getElementById("telefone").value
            };

            if (tipo === "MEDICO") {
                dados.crm = document.getElementById("crm").value;
                dados.especialidade = document.getElementById("esp").value;
            } else {
                dados.cpf = document.getElementById("cpf").value;
                dados.dataNascimento = document.getElementById("data").value;
                dados.endereco = document.getElementById("endereco").value;
            }

            try {
                const res = await fetch("http://localhost:8080/api/usuarios/cadastro", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(dados)
                });
                if (res.status === 201) {
                    alert("Conta criada! Fa√ßa login.");
                    window.location.href = "login.html";
                } else {
                    alert("Erro: " + await res.text());
                }
            } catch(e) { console.error(e); }
        }
    </script>
</body>
</html>